rules_version = '2';
// Regras Firestore - Sistema Legal
// NOTA: O Sistema Legal usa sessão local (senha admin). Para permitir acesso,
// use "if true" em desenvolvimento. Em produção, considere Firebase Auth.
service cloud.firestore {
  match /databases/{database}/documents {

    // --- Módulo Integrações Externas ---
    match /entidades/{docId} {
      allow read, write: if true;
      // allow delete: if false;  // desativar em vez de apagar
    }
    match /integracoes_externas/{docId} {
      allow read, write: if true;
    }
    match /logs_integracoes/{docId} {
      allow read, create: if true;
      allow update, delete: if false;  // só criação, sem alterar/apagar
    }

    // --- Módulo Faturas e Pagamentos ---
    match /faturas/{docId} {
      allow read, write: if true;
      allow delete: if false;  // apenas anulação (soft delete)
    }
    match /pagamentos/{docId} {
      allow read, write: if true;
      allow delete: if false;
    }
    match /despesas/{docId} {
      allow read, write: if true;
      allow delete: if false;
    }
    match /logs_financeiros/{docId} {
      allow read, create: if true;
      allow update, delete: if false;  // imutável
    }

    // --- Módulo Comunicações ---
    match /comunicacoes/{docId} {
      allow read, write: if true;
      allow delete: if false;  // apenas ocultar (soft delete)
    }
    match /anexos_comunicacao/{docId} {
      allow read, write: if true;
      allow delete: if false;
    }
    match /logs_comunicacoes/{docId} {
      allow read, create: if true;
      allow update, delete: if false;  // imutável
    }

    // --- Coleções principais ---
    match /clientes/{docId} {
      allow read, write: if true;
    }
    match /contratos/{docId} {
      allow read, write: if true;
    }
    match /honorarios/{docId} {
      allow read, write: if true;
    }
    match /tarefas/{docId} {
      allow read, write: if true;
    }
    match /prazos/{docId} {
      allow read, write: if true;
    }
    match /notificacoes/{docId} {
      allow read, write: if true;
    }
    match /documentos/{docId} {
      allow read, write: if true;
    }
    match /herancas/{docId} {
      allow read, write: if true;
    }
    match /migracoes/{docId} {
      allow read, write: if true;
    }
    match /registos/{docId} {
      allow read, write: if true;
    }
    match /convidados/{docId} {
      allow read, write: if true;
    }
    match /sistema/{docId} {
      allow read, write: if true;
    }
    match /auditoria/{docId} {
      allow read, write: if true;
    }

    // --- Novas coleções (estrutura completa) ---
    match /representantes/{docId} {
      allow read, write: if true;
      allow delete: if false;
    }
    match /modelos_de_documentos/{docId} {
      allow read, write: if true;
    }
    match /utilizadores/{docId} {
      allow read, write: if true;
    }
    match /tipos_de_processos/{docId} {
      allow read, write: if true;
    }
    match /tipos_de_documentos/{docId} {
      allow read, write: if true;
    }
    match /estados_de_processo/{docId} {
      allow read, write: if true;
    }
    match /checklists/{docId} {
      allow read, write: if true;
    }
    match /tabelas_de_prazos/{docId} {
      allow read, write: if true;
    }
  }
}
