<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fatura/Recibo</title>
  <style>
    /*
     * =============================================================================
     * FATURA/RECIBO — Template profissional A4 vertical
     * Layout idêntico ao documento original: hierarquia, margens, tabelas, tipografia.
     * Logo e QR code: imagens sempre visíveis, alta nitidez, sem distorção.
     * Variáveis: {{issuer_nome}}, {{cliente_nome}}, {{numeroDocumento}}, etc.
     * =============================================================================
     */

    :root {
      --color-text: #1a1a1a;
      --color-text-muted: #4a4a4a;
      --color-border: #dcdcdc;
      --color-border-strong: #999;
      --color-bg: #ffffff;
      --color-bg-logo: #f0f0f0;
      --color-table-header: #f5f5f5;
      --font-sans: 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      /* Margens amplas e equilibradas (A4) */
      --margin-page: 28px 40px;
      --margin-print: 18mm 22mm;
      --space-xs: 4px;
      --space-sm: 10px;
      --space-md: 14px;
      --space-lg: 20px;
      --space-xl: 24px;
      --space-2xl: 32px;
      --max-width: 210mm;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: var(--margin-page);
      font-family: var(--font-sans);
      font-size: 12px;
      line-height: 1.45;
      color: var(--color-text);
      background: var(--color-bg);
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .invoice {
      max-width: var(--max-width);
      margin: 0 auto;
    }

    /* -----------------------------------------------------------------------------
       1) CABEÇALHO — Logo no topo, centrada, alta nitidez (./logo.png)
       Sem redimensionamento forçado, proporções preservadas.
       ----------------------------------------------------------------------------- */
    .header {
      text-align: center;
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-lg);
      border-bottom: 1px solid var(--color-border-strong);
    }

    .header-logo-wrap {
      display: inline-block;
      background: var(--color-bg-logo);
      padding: 12px;
      border: 1px solid var(--color-border);
      margin-bottom: var(--space-md);
    }

    .header-logo-wrap .logo {
      display: block;
      width: auto;
      max-width: 220px;
      height: auto;
      max-height: 130px;
      object-fit: contain;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      vertical-align: middle;
    }

    .header-issuer .nome {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 var(--space-xs) 0;
      color: var(--color-text);
    }

    .header-issuer p {
      margin: var(--space-xs) 0;
      font-size: 11px;
      color: var(--color-text-muted);
      line-height: 1.4;
    }

    /* -----------------------------------------------------------------------------
       2) e 3) TÍTULO DO DOCUMENTO + DATA
       ----------------------------------------------------------------------------- */
    .doc-title {
      margin-bottom: var(--space-xl);
    }

    .doc-title .titulo {
      font-size: 16pt;
      font-weight: 700;
      margin: 0 0 var(--space-xs) 0;
      color: var(--color-text);
    }

    .doc-title .data {
      font-size: 11pt;
      margin: 0;
      color: var(--color-text-muted);
    }

    /* -----------------------------------------------------------------------------
       4) e 5) SECÇÃO CLIENTE — Título em bold, dados em corpo regular
       ----------------------------------------------------------------------------- */
    .client-section {
      margin-bottom: var(--space-xl);
    }

    .section-title {
      font-size: 11pt;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin: 0 0 var(--space-sm) 0;
      color: var(--color-text);
      border-bottom: 1px solid var(--color-border);
      padding-bottom: var(--space-xs);
    }

    .client-block p {
      margin: var(--space-xs) 0;
      font-size: 11pt;
      color: var(--color-text);
      line-height: 1.5;
    }

    .client-block .client-name {
      font-weight: 600;
      color: var(--color-text);
    }

    /* -----------------------------------------------------------------------------
       6) TABELA DE SERVIÇOS — Linhas finas #dcdcdc, cabeçalhos destacados
       Múltiplas linhas dinâmicas (repetir <tr> com {{servico_*}}).
       ----------------------------------------------------------------------------- */
    .items-section {
      margin-bottom: var(--space-xl);
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11pt;
      border: 1px solid var(--color-border);
    }

    .items-table th,
    .items-table td {
      padding: 8px 10px;
      border: 1px solid var(--color-border);
      text-align: left;
      line-height: 1.4;
    }

    .items-table thead th {
      background: var(--color-table-header);
      font-weight: 700;
      color: var(--color-text);
      font-size: 11px;
      text-transform: none;
      letter-spacing: 0;
    }

    .items-table .num { text-align: right; font-variant-numeric: tabular-nums; }
    .items-table .center { text-align: center; }
    .items-table tbody tr:nth-child(even) { background: #fafafa; }
    .items-table tbody td { color: var(--color-text); }

    /* -----------------------------------------------------------------------------
       7) TABELA DE DESPESAS — Mesmo estilo, múltiplas linhas dinâmicas
       ----------------------------------------------------------------------------- */
    .despesas-section {
      margin-bottom: var(--space-xl);
    }

    .despesas-section .section-title {
      margin-bottom: var(--space-sm);
    }

    .despesas-section .items-table {
      margin-top: 0;
    }

    /* -----------------------------------------------------------------------------
       8) RESUMO — Serviços/Produtos, Despesas, IVA, Total, Valor a Pagar
       Caixa alinhada à direita, linhas finas.
       ----------------------------------------------------------------------------- */
    .totals-section {
      margin-bottom: var(--space-xl);
    }

    .totals-wrap {
      display: flex;
      justify-content: flex-end;
      width: 100%;
    }

    .totals-table {
      min-width: 240px;
      border-collapse: collapse;
      font-size: 11pt;
      border: 1px solid var(--color-border);
    }

    .totals-table td {
      padding: 8px 12px;
      border: 1px solid var(--color-border);
      line-height: 1.4;
    }

    .totals-table td:first-child {
      background: var(--color-table-header);
      font-weight: 600;
      color: var(--color-text);
    }

    .totals-table .right {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .totals-table .total-row td,
    .totals-table .valor-pagar-row td {
      font-weight: 700;
      background: #f8f8f8;
      color: var(--color-text);
    }

    /* -----------------------------------------------------------------------------
       9) SECÇÃO RECIBO — Nº, Data, Valor Recebido
       ----------------------------------------------------------------------------- */
    .receipt-section {
      margin-bottom: var(--space-xl);
    }

    .receipt-block {
      padding: var(--space-md) 0;
      border-top: 1px solid var(--color-border-strong);
      border-bottom: 1px solid var(--color-border-strong);
    }

    .receipt-block p {
      margin: var(--space-xs) 0;
      font-size: 11pt;
      color: var(--color-text);
      line-height: 1.5;
    }

    /* -----------------------------------------------------------------------------
       10) OBSERVAÇÕES — Texto variável (ex.: Artigo n.º 53)
       ----------------------------------------------------------------------------- */
    .notes-section {
      margin-bottom: var(--space-2xl);
    }

    .notes-block {
      padding: var(--space-sm) 0;
      font-size: 11pt;
      color: var(--color-text);
      white-space: pre-wrap;
      line-height: 1.5;
    }

    /* -----------------------------------------------------------------------------
       11) QR CODE — Sempre no canto inferior direito (./qrcode.png)
       120x120px, sem distorção.
       ----------------------------------------------------------------------------- */
    .footer {
      text-align: right;
      margin-top: var(--space-2xl);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--color-border-strong);
    }

    .footer .qrcode {
      width: 120px;
      height: 120px;
      min-width: 120px;
      min-height: 120px;
      max-width: 120px;
      max-height: 120px;
      object-fit: contain;
      border: 1px solid var(--color-border);
      display: inline-block;
      vertical-align: middle;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    /* -----------------------------------------------------------------------------
       IMPRESSÃO PDF — A4 vertical, margens equilibradas, layout estável
       Imagens sempre visíveis, sem compressão.
       ----------------------------------------------------------------------------- */
    @media print {
      body {
        padding: var(--margin-print) !important;
        background: #fff !important;
      }

      .invoice {
        max-width: none !important;
      }

      .header-logo-wrap .logo,
      .footer .qrcode {
        visibility: visible !important;
        display: block !important;
        opacity: 1 !important;
      }

      .header-logo-wrap .logo {
        width: auto !important;
        max-width: 220px !important;
        height: auto !important;
        max-height: 130px !important;
      }

      .footer .qrcode {
        width: 120px !important;
        height: 120px !important;
        min-width: 120px !important;
        min-height: 120px !important;
      }

      .header, .doc-title, .client-section, .items-section, .despesas-section,
      .totals-section, .receipt-section, .notes-section {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="invoice">
    <!-- 1) Cabeçalho: logo centrada (./logo.png — não substituir, não distorcer) -->
    <header class="header">
      <div class="header-logo-wrap">
        <img src="./logo.png" class="logo" alt="logo">
      </div>
      <div class="header-issuer">
        <p class="nome">{{issuer_nome}}</p>
        <p>NIF: {{issuer_nif}}</p>
        <p>Tlm: {{issuer_telefone}}</p>
        <p>Email: {{issuer_email}}</p>
        <p>IBAN: {{issuer_iban}}</p>
        <p>Sede: {{issuer_morada}}</p>
      </div>
    </header>

    <!-- 2) e 3) Título e data -->
    <div class="doc-title">
      <p class="titulo">Fatura/Recibo {{numeroDocumento}}</p>
      <p class="data">Data: {{dataDocumento}}</p>
    </div>

    <!-- 4) e 5) Secção Cliente -->
    <section class="client-section">
      <h3 class="section-title">Cliente</h3>
      <div class="client-block">
        <p class="client-name">{{cliente_nome}}</p>
        <p>NIF: {{cliente_nif}}</p>
        <p>{{cliente_morada}}</p>
      </div>
    </section>

    <!-- 6) Tabela de Serviços (múltiplas linhas: repetir <tr> com {{servico_descricao}}, {{servico_artigo}}, etc.) -->
    <section class="items-section">
      <table class="items-table">
        <thead>
          <tr>
            <th>Descrição</th>
            <th class="center">Art.</th>
            <th class="center">Qtd</th>
            <th class="center">Incidência</th>
            <th class="num">Preço Unit.</th>
            <th class="center">IVA %</th>
            <th class="num">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{servico_descricao}}</td>
            <td class="center">{{servico_artigo}}</td>
            <td class="center">{{servico_quantidade}}</td>
            <td class="center">{{servico_incidencia}}</td>
            <td class="num">{{servico_precoUnit}}</td>
            <td class="center">{{servico_iva}}</td>
            <td class="num">{{servico_total}}</td>
          </tr>
          <!-- Repetir a linha acima para cada serviço (servico_descricao_2, servico_artigo_2, …) -->
        </tbody>
      </table>
    </section>

    <!-- 7) Tabela de Despesas (múltiplas linhas: repetir <tr> com {{despesa_descricao}}, {{despesa_valor}}, etc.) -->
    <section class="despesas-section">
      <h3 class="section-title">Despesas</h3>
      <table class="items-table">
        <thead>
          <tr>
            <th>Descrição</th>
            <th class="num">Valor</th>
            <th class="center">IVA %</th>
            <th class="num">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{despesa_descricao}}</td>
            <td class="num">{{despesa_valor}}</td>
            <td class="center">{{despesa_iva}}</td>
            <td class="num">{{despesa_total}}</td>
          </tr>
          <!-- Repetir a linha acima para cada despesa -->
        </tbody>
      </table>
    </section>

    <!-- 8) Resumo: Serviços/Produtos, Despesas, IVA, Total, Valor a Pagar -->
    <section class="totals-section">
      <div class="totals-wrap">
        <table class="totals-table">
          <tr><td>Serviços/Produtos</td><td class="right">{{totalServicos}}</td></tr>
          <tr><td>Despesas</td><td class="right">{{totalDespesas}}</td></tr>
          <tr><td>IVA</td><td class="right">{{totalIVA}}</td></tr>
          <tr class="total-row"><td>Total</td><td class="right">{{totalGeral}}</td></tr>
          <tr class="valor-pagar-row"><td>Valor a Pagar</td><td class="right">{{valorAPagar}}</td></tr>
        </table>
      </div>
    </section>

    <!-- 9) Secção Recibo -->
    <section class="receipt-section">
      <h3 class="section-title">Recibo</h3>
      <div class="receipt-block">
        <p><strong>Nº:</strong> {{numeroDocumento}}</p>
        <p><strong>Data:</strong> {{dataDocumento}}</p>
        <p><strong>Valor Recebido:</strong> {{valorAPagar}}</p>
      </div>
    </section>

    <!-- 10) Observações -->
    <section class="notes-section">
      <h3 class="section-title">Observações</h3>
      <div class="notes-block">{{observacoes}}</div>
    </section>

    <!-- 11) QR code no canto inferior direito (./qrcode.png — sempre exibido) -->
    <div class="footer">
      <img src="./qrcode.png" class="qrcode" alt="qr">
    </div>
  </div>
</body>
</html>
