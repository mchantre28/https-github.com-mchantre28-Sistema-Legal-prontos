<div class="invoice-body">
  <div class="invoice-container">
    <!-- Header: Logo (esquerda) + Dados da solicitadora (direita) -->
    <div class="header">
      {{#if logo}}
      <img src="{{logo}}" class="logo" alt="Logotipo da Solicitadora" loading="eager" decoding="sync" />
      {{/if}}
      <div class="issuer-info">
        <h1>{{#if issuer.titulo}}{{issuer.titulo}} {{/if}}{{issuer.name}}</h1>
        {{#if issuer.nif}}<p>NIF: {{formatNif issuer.nif}}</p>{{/if}}
        {{#if issuer.phone}}<p>Tlm: {{issuer.phone}}</p>{{/if}}
        {{#if issuer.email}}<p>Email: {{issuer.email}}</p>{{/if}}
        {{#if issuer.iban}}<p>IBAN: {{issuer.iban}}</p>{{/if}}
        <p>Sede: {{issuer.sede}}</p>
      </div>
    </div>


    <hr class="divider" />

    <!-- Fatura/Recibo + Data -->
    <div class="doc-info">
      <h3>{{#if recibo}}Fatura/Recibo{{else}}Fatura{{/if}} {{numero}}</h3>
      <p>Data: {{formatDate dataEmissao}}</p>
    </div>

    <!-- Cliente -->
    <div class="client-section">
      <h4>Cliente</h4>
      <p class="client-name">{{cliente.nome}}</p>
      {{#if cliente.nif}}<p>NIF: {{formatNif cliente.nif}}</p>{{/if}}
      <p>{{cliente.morada}}</p>
      <p>{{cliente.codigoPostal}} {{cliente.localidade}}</p>
    </div>

    {{#if itens.length}}
    <!-- Tabela de serviços -->
    <table class="items">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Art.</th>
          <th>Qtd</th>
          <th>Incidência</th>
          <th>Preço Unit.</th>
          <th>IVA %</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {{#each itens}}
        <tr>
          <td>{{descricao}}</td>
          <td>{{artigo}}</td>
          <td>{{quantidade}}</td>
          <td>{{incidencia}}</td>
          <td>{{formatCurrency precoUnitario}}</td>
          <td>{{#if ivaPercent}}{{ivaPercent}}{{else}}0{{/if}}%</td>
          <td>{{formatCurrency total}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{/if}}

    {{#if hasDespesas}}
    <!-- Tabela de despesas -->
    <h4 class="despesas-title">Despesas</h4>
    <table class="items despesas-table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor</th>
          <th>IVA %</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {{#each despesas}}
        <tr>
          <td>{{descricao}}</td>
          <td>{{formatCurrency precoUnitario}}</td>
          <td>{{#if ivaPercent}}{{ivaPercent}}{{else}}0{{/if}}%</td>
          <td>{{formatCurrency total}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{/if}}

    <!-- Totais (alinhados à direita) -->
    <div class="totals-wrap">
      <table class="totals">
        <tr>
          <td>Serviços/Produtos</td>
          <td>{{formatCurrency subtotalServicos}}</td>
        </tr>
        {{#if hasDespesas}}
        <tr>
          <td>Despesas</td>
          <td>{{formatCurrency subtotalDespesas}}</td>
        </tr>
        {{/if}}
        <tr>
          <td>IVA</td>
          <td>{{formatCurrency totais.iva}}</td>
        </tr>
        <tr class="total-row">
          <td>Total</td>
          <td>{{formatCurrency totais.totalComIva}}</td>
        </tr>
        <tr class="pay-row">
          <td>Valor a Pagar</td>
          <td>{{formatCurrency totais.valorAPagar}}</td>
        </tr>
      </table>
    </div>

    {{#if recibo}}
    <!-- Recibo -->
    <div class="receipt-section">
      <h4>Recibo</h4>
      <p>Nº: {{recibo.numero}}</p>
      <p>Data: {{formatDate recibo.data}}</p>
      <p>Valor Recebido: {{formatCurrency recibo.valorRecebido}}</p>
    </div>
    {{/if}}

    {{#if observacoes}}
    <!-- Observações -->
    <div class="observations">
      <h4>Observações</h4>
      <p>{{observacoes}}</p>
    </div>
    {{/if}}
    {{#if mencoesLegais}}
    <div class="observations">
      <p>{{mencoesLegais}}</p>
    </div>
    {{/if}}

    <!-- QR Code (canto inferior direito) -->
    <div class="footer">
      {{#if qrCodeBase64}}
      <img src="data:image/png;base64,{{qrCodeBase64}}" class="qrcode" alt="QR Code" />
      {{/if}}
    </div>
  </div>
</div>
